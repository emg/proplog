<IfModule mod_ssl.c>
<VirtualHost *:443>
	Define serverdns logic.aau.dk

        ServerName ${serverdns}

        Define webroot /srv/web/default

        Define docroot ${webroot}/http
        Define djangoroot ${webroot}/git/proplog/backend/Django/logproplogsite
        Define virtualenvroot ${webroot}/virtualenv
	
	RewriteEngine on
	Include /srv/conf/apache2/includes/rewrite_add_www.conf
	Include /srv/conf/apache2/includes/rewrite_remove_www.conf

	DocumentRoot ${docroot}

	<Directory ${docroot}/>
		Require all granted
	</Directory>

	<Directory ${djangoroot}/logproplogsite>
               <Files wsgi.py>
                     Require all granted
               </Files>
	</Directory>

        <Directory ${docroot}/proplog/static/>
                Order deny,allow
                Allow from all
        </Directory>

        <Directory ${djangoroot}/static/>
		Require all granted
        </Directory>


	<Directory ${webroot}/virtualenv/>
		Require all granted
	</Directory>


        Alias /static/ ${docroot}/proplog/static/
        Alias /proplog/static/ ${docroot}/proplog/static/
        Alias /proplog/applet/ ${docroot}/proplog/applet/
        Alias /proplog/target/ ${docroot}/proplog/target/

	# Log levels: trace8, ..., trace1, debug, info, notice, warn,
        # error, crit, alert, emerg.
	LogLevel warn rewrite:trace1
	ErrorLog ${webroot}/log/error.log
	CustomLog ${webroot}/log/access.log combined


ServerAlias ${serverdns}
SSLCertificateFile /etc/letsencrypt/live/${serverdns}/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/${serverdns}/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf


         WSGIDaemonProcess proplog.${serverdns} processes=2 threads=15 display-name=%{GROUP} python-path=${virtualenvroot}/lib/python3.6/site-packages:${djangoroot}
         WSGIProcessGroup proplog.${serverdns}
         WSGIScriptAlias /proplog ${djangoroot}/logproplogsite/wsgi.py

</VirtualHost>
</IfModule>
